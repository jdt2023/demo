document.addEventListener("DOMContentLoaded", function() {
  let db;
  const messagesContainer = document.querySelector('.messages');
  const inputField = document.querySelector('.input-container input');
  const sendButton = document.querySelector('.input-container button');

  const request = indexedDB.open('chatDatabase', 1);

  request.onupgradeneeded = function(event) {
    db = event.target.result;
    const objectStore = db.createObjectStore('messages', { autoIncrement: true });
  };

  request.onsuccess = function(event) {
    db = event.target.result;

    // 加载消息
    const transaction = db.transaction(['messages'], 'readonly');
    const objectStore = transaction.objectStore('messages');
    objectStore.openCursor().onsuccess = function(event) {
      const cursor = event.target.result;
      if (cursor) {
        const messageElement = document.createElement('div');
        messageElement.textContent = cursor.value;
        messagesContainer.appendChild(messageElement);
        cursor.continue();
      }
    };
  };

  sendButton.addEventListener('click', function() {
    const message = inputField.value;
    if (message) {
      const transaction = db.transaction(['messages'], 'readwrite');
      const objectStore = transaction.objectStore('messages');
      objectStore.add(message);

      const messageElement = document.createElement('div');
      messageElement.textContent = message;
      messagesContainer.appendChild(messageElement);

      inputField.value = ''; // 清空输入框
    }
  });
});
